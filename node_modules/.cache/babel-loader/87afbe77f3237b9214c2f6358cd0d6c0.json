{"ast":null,"code":"import { employeeTaskDetail } from \"@/api/square\";\nimport { Checked } from \"@element-plus/icons-vue\";\nimport { reactive } from \"vue\";\nimport { publishReport } from \"@/api/report\";\nimport oss from '@/utils/oss';\nconst report_form = reactive({\n  reportName: '',\n  defectPictureList: [],\n  defectExplain: '',\n  defectReproductionStep: '',\n  testEquipmentInformation: ''\n});\nconst rules = reactive({\n  reportName: [{\n    required: true,\n    message: '请填写报告名称',\n    trigger: 'blur'\n  }],\n  defectExplain: [{\n    required: true,\n    message: '请填写缺陷情况说明',\n    trigger: 'blur'\n  }, {\n    min: 5,\n    max: 100,\n    message: '缺陷情况说明不得少于5个字符，不得多于100个字符',\n    trigger: 'blur'\n  }],\n  defectReproductionStep: [{\n    required: true,\n    message: '请填写缺陷复现步骤',\n    trigger: 'blur'\n  }, {\n    min: 5,\n    max: 100,\n    message: '缺陷复现步骤不得少于5个字符，不得多于100个字符',\n    trigger: 'blur'\n  }],\n  testEquipmentInformation: [{\n    required: true,\n    message: '请填写测试设备信息',\n    trigger: 'blur'\n  }, {\n    min: 5,\n    max: 20,\n    message: '测试设备信息不得少于5个字符，不得多于20个字符',\n    trigger: 'blur'\n  }]\n});\nexport default {\n  name: \"ReportRelease\",\n\n  data() {\n    return {\n      report_form,\n      rules,\n      task: {},\n      taskId: this.$route.params.taskId,\n      fileList: []\n    };\n  },\n\n  mounted() {\n    employeeTaskDetail({\n      taskId: this.taskId,\n      token: window.localStorage.getItem(\"token\")\n    }).then(res => {\n      if (res.response.code === 0) {\n        console.log(\"获取任务数据成功\");\n        this.task = res.task;\n      } else {\n        console.log(res.response.msg);\n      }\n    });\n  },\n\n  components: {\n    Checked\n  },\n  methods: {\n    onSubmit() {\n      const token = window.localStorage.getItem(\"token\");\n      publishReport({\n        testReport: report_form,\n        token: token,\n        taskId: this.taskId\n      }).then(res => {\n        if (res.response.code === 0) {\n          console.log(res.response.msg);\n        } else {\n          console.log(res.response.msg);\n        }\n      });\n    },\n\n    cancelSubmit() {\n      this.$router.back(-1);\n    },\n\n    async fnUploadRequest(option) {\n      await oss.ossUploadFile(option).then(res => {\n        const file = {\n          fileName: res.fileName,\n          fileUrl: res.fileUrl\n        };\n        report_form.defectPictureList.push(file);\n      });\n    },\n\n    handleUploadSuccess() {\n      console.log(report_form.defectPictureList); //todo:添加路由：报告提交成功\n\n      this.$router.push(\"/reportReleaseSucceed\");\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["employeeTaskDetail","Checked","reactive","publishReport","oss","report_form","reportName","defectPictureList","defectExplain","defectReproductionStep","testEquipmentInformation","rules","required","message","trigger","min","max","name","data","task","taskId","$route","params","fileList","mounted","token","window","localStorage","getItem","then","res","response","code","console","log","msg","components","methods","onSubmit","testReport","cancelSubmit","$router","back","fnUploadRequest","option","ossUploadFile","file","fileName","fileUrl","push","handleUploadSuccess"],"sourceRoot":"","sources":["/home/lyk/Projects/Volatile/frontend-volatile/src/views/report/ReportRelease.vue"],"sourcesContent":["<template>\n  <div style=\"display: flex;justify-content: center;text-align: center\">\n  <el-card style=\"width: 80%\">\n    <template #header>\n      <span style=\"font-weight: bolder;font-size:x-large\">测试报告提交</span>\n    </template>\n    <div class=\"task_container\">\n      <el-descriptions>\n        <template #title>\n          <span>任务名称： {{task.taskName}}</span>\n        </template>\n        <el-descriptions-item label=\"任务简介\">{{task.taskIntroduction}}</el-descriptions-item>\n      </el-descriptions>\n    </div>\n    <div class=\"report_container\">\n      <div class=\"report_head_container\">\n        <el-icon color=\"#409efc\" :size=\"30\">\n          <checked />\n        </el-icon>\n        <div style=\"font-size: large;margin-top: 2px;font-weight: bolder;margin-left: 5px\">缺陷提交</div>\n      </div>\n      <el-form :model=\"report_form\" label-width=\"120px\" label-position=\"right\" style=\"width:80%\" :rules=\"rules\">\n        <el-form-item label=\"测试报告名称\" prop=\"reportName\">\n          <el-input v-model=\"report_form.reportName\" />\n        </el-form-item>\n        <el-form-item label=\"缺陷情况说明\" prop=\"defectExplain\">\n          <el-input v-model=\"report_form.defectExplain\" :rows=\"3\" type=\"textarea\" />\n        </el-form-item>\n        <el-form-item label=\"缺陷复现步骤\" prop=\"defectReproductionStep\">\n          <el-input v-model=\"report_form.defectReproductionStep\" :rows=\"2\" type=\"textarea\" />\n        </el-form-item>\n        <el-form-item label=\"测试设备信息\" prop=\"testEquipmentInformation\">\n          <el-input v-model=\"report_form.testEquipmentInformation\" placeholder=\"从应用启动到缺陷出现的操作步骤\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"缺陷应用截图\" required>\n          <el-upload\n            action=\"\"\n            show-file-list\n            :auto-upload=\"true\"\n            :http-request=\"fnUploadRequest\"\n            :on-success=\"handleUploadSuccess\"\n            :file-list=\"fileList\"\n            list-type=\"picture\">\n            <el-button type=\"primary\">点击上传应用截图</el-button>\n            <template #tip>\n              <div style=\"color: #9A9A9A\">\n                请上传.jpg,.jpeg,.png类型的文件\n              </div>\n            </template>\n          </el-upload>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"onSubmit\">提交</el-button>\n          <el-button @click=\"cancelSubmit\">取消</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n  </el-card>\n  </div>\n</template>\n\n<script>\nimport {employeeTaskDetail} from \"@/api/square\";\nimport {Checked} from \"@element-plus/icons-vue\"\nimport {reactive} from \"vue\"\nimport {publishReport} from \"@/api/report\";\nimport oss from '@/utils/oss'\n\nconst report_form = reactive({\n  reportName:'',\n  defectPictureList:[],\n  defectExplain:'',\n  defectReproductionStep:'',\n  testEquipmentInformation:''\n})\n\nconst rules = reactive({\n  reportName:[\n    {\n      required:true,\n      message:'请填写报告名称',\n      trigger:'blur'\n    }\n  ],\n  defectExplain:[\n    {\n      required:true,\n      message:'请填写缺陷情况说明',\n      trigger:'blur'\n    },\n    {\n      min:5,\n      max:100,\n      message: '缺陷情况说明不得少于5个字符，不得多于100个字符',\n      trigger: 'blur'\n    }\n  ],\n  defectReproductionStep: [\n    {\n      required:true,\n      message:'请填写缺陷复现步骤',\n      trigger:'blur'\n    },\n    {\n      min:5,\n      max:100,\n      message: '缺陷复现步骤不得少于5个字符，不得多于100个字符',\n      trigger:'blur'\n    }\n  ],\n  testEquipmentInformation:[\n    {\n      required:true,\n      message:'请填写测试设备信息',\n      trigger:'blur'\n    },\n    {\n      min:5,\n      max:20,\n      message: '测试设备信息不得少于5个字符，不得多于20个字符',\n      trigger:'blur'\n    }\n  ],\n})\n\nexport default {\n  name: \"ReportRelease\",\n  data(){\n    return {\n      report_form,\n      rules,\n      task:{},\n      taskId:this.$route.params.taskId,\n      fileList:[],\n    }\n  },\n  mounted() {\n    employeeTaskDetail({taskId:this.taskId,token:window.localStorage.getItem(\"token\")})\n    .then(res => {\n      if(res.response.code === 0)\n      {\n        console.log(\"获取任务数据成功\")\n        this.task = res.task\n      }\n      else\n      {\n        console.log(res.response.msg)\n      }\n    })\n  },\n  components:{\n    Checked\n  },\n  methods:{\n    onSubmit() {\n      const token = window.localStorage.getItem(\"token\")\n      publishReport({testReport: report_form,token:token,taskId:this.taskId})\n      .then(res =>{\n        if(res.response.code === 0)\n        {\n          console.log(res.response.msg)\n        }\n        else\n        {\n          console.log(res.response.msg)\n        }\n      })\n    },\n    cancelSubmit(){\n      this.$router.back(-1)\n    },\n    async fnUploadRequest(option){\n      await oss.ossUploadFile(option).then(res => {\n        const file = {\n          fileName:res.fileName,\n          fileUrl:res.fileUrl\n        }\n        report_form.defectPictureList.push(file)\n      })\n    },\n    handleUploadSuccess(){\n      console.log(report_form.defectPictureList)\n      //todo:添加路由：报告提交成功\n      this.$router.push(\"/reportReleaseSucceed\")\n    }\n  }\n}\n</script>\n\n<style scoped>\n.report_head_container{\n  display: flex;\n  flex-direction: row;\n}\n</style>"]},"metadata":{},"sourceType":"module"}